/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */

/*
 * BankIFrame.java
 *
 * Created on 01 Sep 14, 21:10:40
 */
package com.ivanbiz.ui;

import com.ivanbiz.dao.AksesMatrixDAO;
import com.ivanbiz.dao.GroupsDAO;
import com.ivanbiz.dao.impl.AksesMatrixDAOImpl;
import com.ivanbiz.dao.impl.GroupsDAOImpl;
import com.ivanbiz.model.AksesMatrix;
import com.ivanbiz.model.Groups;
import com.ivanbiz.service.MenuAksesConstant;
import com.ivanbiz.service.ServiceHelper;
import java.util.ArrayList;
import java.util.List;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.swing.JOptionPane;

/**
 *
 * @author Shbt Peterpan
 */
public class GroupIFrame extends javax.swing.JInternalFrame {

    Groups groups;
    GroupsDAO groupsDAO;
    AksesMatrixDAO aksesMatrixDAO;
    List<Groups> listGroups;
    List<AksesMatrix> listAksesMatrixView;
    List<AksesMatrix> listAksesMatrix;

    /** Creates new form BankIFrame */
    public GroupIFrame(List<AksesMatrix> listAksesMatrix) {
        initComponents();
        renderHakAkses(listAksesMatrix);
        aksesMatrixDAO = new AksesMatrixDAOImpl();
        groupsDAO = new GroupsDAOImpl();
        refresh();
    }

    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        GroupUpdateDialog = new javax.swing.JDialog();
        labelGroup = new javax.swing.JLabel();
        jPanel1 = new javax.swing.JPanel();
        jLabel2 = new javax.swing.JLabel();
        textNama = new javax.swing.JTextField();
        jLabel3 = new javax.swing.JLabel();
        jScrollPane2 = new javax.swing.JScrollPane();
        tableAkses = new javax.swing.JTable();
        jPanel8 = new javax.swing.JPanel();
        buttonSimpan = new javax.swing.JButton();
        buttonBatal = new javax.swing.JButton();
        jPanel9 = new javax.swing.JPanel();
        buttonTambah = new javax.swing.JButton();
        buttonUbah = new javax.swing.JButton();
        buttonHapus = new javax.swing.JButton();
        jLabel4 = new javax.swing.JLabel();
        jScrollPane1 = new javax.swing.JScrollPane();
        tableGroup = new javax.swing.JTable();

        labelGroup.setText("{} Group");

        jPanel1.setBorder(javax.swing.BorderFactory.createTitledBorder("Data Group"));

        jLabel2.setText("Nama :");

        jLabel3.setText("Hak Akses :");

        tableAkses.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null, null, null},
                {null, null, null, null},
                {null, null, null, null},
                {null, null, null, null}
            },
            new String [] {
                "Title 1", "Title 2", "Title 3", "Title 4"
            }
        ));
        jScrollPane2.setViewportView(tableAkses);

        javax.swing.GroupLayout jPanel1Layout = new javax.swing.GroupLayout(jPanel1);
        jPanel1.setLayout(jPanel1Layout);
        jPanel1Layout.setHorizontalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jLabel2)
                    .addComponent(textNama, javax.swing.GroupLayout.DEFAULT_SIZE, 348, Short.MAX_VALUE)
                    .addComponent(jLabel3)
                    .addComponent(jScrollPane2, javax.swing.GroupLayout.DEFAULT_SIZE, 348, Short.MAX_VALUE))
                .addContainerGap())
        );
        jPanel1Layout.setVerticalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addComponent(jLabel2)
                .addGap(5, 5, 5)
                .addComponent(textNama, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jLabel3)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jScrollPane2, javax.swing.GroupLayout.DEFAULT_SIZE, 187, Short.MAX_VALUE)
                .addContainerGap())
        );

        buttonSimpan.setText("Simpan");
        buttonSimpan.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                buttonSimpanActionPerformed(evt);
            }
        });
        jPanel8.add(buttonSimpan);

        buttonBatal.setText("Batal");
        buttonBatal.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                buttonBatalActionPerformed(evt);
            }
        });
        jPanel8.add(buttonBatal);

        javax.swing.GroupLayout GroupUpdateDialogLayout = new javax.swing.GroupLayout(GroupUpdateDialog.getContentPane());
        GroupUpdateDialog.getContentPane().setLayout(GroupUpdateDialogLayout);
        GroupUpdateDialogLayout.setHorizontalGroup(
            GroupUpdateDialogLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(GroupUpdateDialogLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(GroupUpdateDialogLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jPanel1, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(labelGroup, javax.swing.GroupLayout.DEFAULT_SIZE, 380, Short.MAX_VALUE)
                    .addComponent(jPanel8, javax.swing.GroupLayout.DEFAULT_SIZE, 380, Short.MAX_VALUE))
                .addContainerGap())
        );
        GroupUpdateDialogLayout.setVerticalGroup(
            GroupUpdateDialogLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(GroupUpdateDialogLayout.createSequentialGroup()
                .addContainerGap()
                .addComponent(labelGroup)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jPanel1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jPanel8, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        setClosable(true);
        setMaximizable(true);

        buttonTambah.setText("Tambah Group Baru");
        buttonTambah.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                buttonTambahActionPerformed(evt);
            }
        });
        jPanel9.add(buttonTambah);

        buttonUbah.setText("Ubah Group Terseleksi");
        buttonUbah.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                buttonUbahActionPerformed(evt);
            }
        });
        jPanel9.add(buttonUbah);

        buttonHapus.setText("Hapus Group Terseleksi");
        buttonHapus.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                buttonHapusActionPerformed(evt);
            }
        });
        jPanel9.add(buttonHapus);

        jLabel4.setFont(new java.awt.Font("Tahoma", 1, 24));
        jLabel4.setText("Daftar Group");

        tableGroup.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null, null, null},
                {null, null, null, null},
                {null, null, null, null},
                {null, null, null, null}
            },
            new String [] {
                "Title 1", "Title 2", "Title 3", "Title 4"
            }
        ));
        jScrollPane1.setViewportView(tableGroup);

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addComponent(jScrollPane1, javax.swing.GroupLayout.Alignment.LEADING, javax.swing.GroupLayout.DEFAULT_SIZE, 764, Short.MAX_VALUE)
                    .addComponent(jLabel4, javax.swing.GroupLayout.Alignment.LEADING, javax.swing.GroupLayout.DEFAULT_SIZE, 764, Short.MAX_VALUE)
                    .addComponent(jPanel9, javax.swing.GroupLayout.Alignment.LEADING, javax.swing.GroupLayout.DEFAULT_SIZE, 764, Short.MAX_VALUE))
                .addContainerGap())
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jLabel4)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jScrollPane1, javax.swing.GroupLayout.DEFAULT_SIZE, 475, Short.MAX_VALUE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jPanel9, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap())
        );

        java.awt.Dimension screenSize = java.awt.Toolkit.getDefaultToolkit().getScreenSize();
        setBounds((screenSize.width-800)/2, (screenSize.height-600)/2, 800, 600);
    }// </editor-fold>//GEN-END:initComponents

    private void buttonTambahActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_buttonTambahActionPerformed
        labelGroup.setText("Tambah Group Baru");
        textNama.setText("");
        listAksesMatrix = new ArrayList<AksesMatrix>();
        listAksesMatrixView = new ArrayList<AksesMatrix>();
        renderTableAkses();
        renderBankUpdateDialog();
}//GEN-LAST:event_buttonTambahActionPerformed

    private void buttonHapusActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_buttonHapusActionPerformed
        if (tableGroup.getSelectedRow() == -1) {
            JOptionPane.showMessageDialog(this, "Pilih salah satu data", "warning", JOptionPane.WARNING_MESSAGE);
        } else {
            try {
                groups = listGroups.get(tableGroup.getSelectedRow());
                if (null != aksesMatrixDAO.getDataByEquals(AksesMatrix.class, "groups.id", groups.getId())) {
                    List<AksesMatrix> list = aksesMatrixDAO.getDataByEquals(AksesMatrix.class, "groups.id", groups.getId());
                    groupsDAO.delete(groups, list);
                } else {
                    groupsDAO.delete(groups);
                }
                refresh();
            } catch (Exception ex) {
                Logger.getLogger(GroupIFrame.class.getName()).log(Level.SEVERE, null, ex);
            }
        }
    }//GEN-LAST:event_buttonHapusActionPerformed

    private void buttonUbahActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_buttonUbahActionPerformed
        if (tableGroup.getSelectedRow() == -1) {
            JOptionPane.showMessageDialog(this, "Pilih salah satu data", "warning", JOptionPane.WARNING_MESSAGE);
        } else {
            try {
                groups = listGroups.get(tableGroup.getSelectedRow());
                listAksesMatrixView = new ArrayList<AksesMatrix>();
                listAksesMatrix = aksesMatrixDAO.getDataByEquals(AksesMatrix.class, "groups.id", groups.getId());
                textNama.setText(groups.getNama());
                labelGroup.setText("Update Group");
                renderTableAkses();
                renderBankUpdateDialog();
            } catch (Exception ex) {
                Logger.getLogger(GroupIFrame.class.getName()).log(Level.SEVERE, null, ex);
            }
        }
    }//GEN-LAST:event_buttonUbahActionPerformed

    private void buttonSimpanActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_buttonSimpanActionPerformed
        if (labelGroup.getText().equals("Tambah Group Baru")) {
            groups = new Groups();
        }
        groups.setNama(textNama.getText());
        validate(groups);
}//GEN-LAST:event_buttonSimpanActionPerformed

    private void buttonBatalActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_buttonBatalActionPerformed
        GroupUpdateDialog.dispose();
    }//GEN-LAST:event_buttonBatalActionPerformed

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JDialog GroupUpdateDialog;
    private javax.swing.JButton buttonBatal;
    private javax.swing.JButton buttonHapus;
    private javax.swing.JButton buttonSimpan;
    private javax.swing.JButton buttonTambah;
    private javax.swing.JButton buttonUbah;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel8;
    private javax.swing.JPanel jPanel9;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JScrollPane jScrollPane2;
    private javax.swing.JLabel labelGroup;
    private javax.swing.JTable tableAkses;
    private javax.swing.JTable tableGroup;
    private javax.swing.JTextField textNama;
    // End of variables declaration//GEN-END:variables

    private void refresh() {
        try {
            listGroups = groupsDAO.getAll(Groups.class);
            updateTableGroups();
        } catch (Exception ex) {
            Logger.getLogger(GroupIFrame.class.getName()).log(Level.SEVERE, null, ex);
        }
    }

    private void renderBankUpdateDialog() {
        GroupUpdateDialog.setSize(400, 400);
        GroupUpdateDialog.setVisible(true);
        GroupUpdateDialog.setLocationRelativeTo(this);
        GroupUpdateDialog.setModal(true);
    }
    // End of variables declaration

    private void renderHakAkses(List<AksesMatrix> listAksesMatrix) {
        buttonTambah.setEnabled(MenuAksesConstant.validate(MenuAksesConstant.TAMBAH_GROUP, listAksesMatrix));
        buttonUbah.setEnabled(MenuAksesConstant.validate(MenuAksesConstant.UBAH_GROUP, listAksesMatrix));
        buttonHapus.setEnabled(MenuAksesConstant.validate(MenuAksesConstant.HAPUS_GROUP, listAksesMatrix));
    }

    private void renderTableAkses() {
        for (MenuAksesConstant menuAksesConstant : MenuAksesConstant.values()) {
            AksesMatrix aksesMatrix = new AksesMatrix();
            aksesMatrix.setNama(menuAksesConstant.toString());
            aksesMatrix.setMenuChecked(MenuAksesConstant.validate(menuAksesConstant, listAksesMatrix));
            listAksesMatrixView.add(aksesMatrix);
        }
        updateTableAkses();
    }

    private void updateTableAkses() {
        String[] judul = {"Choose", "Nama"};
        Object[][] isi = null;
        isi = new Object[listAksesMatrixView.size()][2];
        int x = 0;
        for (AksesMatrix aksesMatrix : listAksesMatrixView) {
            isi[x][0] = aksesMatrix.isMenuChecked();
            isi[x][1] = aksesMatrix.getNama();
            x++;
        }
        new ServiceHelper().setAutoRize(isi, judul, tableAkses);
    }

    private void updateTableGroups() {
        String[] judul = {"No", "Nama"};
        Object[][] isi = new Object[listGroups.size()][2];
        int x = 0;
        int no = 0;
        for (Groups groupss : listGroups) {
            no += 1;
            isi[x][0] = no;
            isi[x][1] = groupss.getNama();
            x++;
        }
        new ServiceHelper().setAutoRize(isi, judul, tableGroup);
    }

    private void validate(Groups groups) {
        if (groups == null) {
            JOptionPane.showMessageDialog(this, "Group tidak boleh null");
        } else if (groups.getNama() == null) {
            JOptionPane.showMessageDialog(this, "Nama tidak boleh null");
        } else if (groups.getNama().trim().isEmpty()) {
            JOptionPane.showMessageDialog(this, "Nama tidak boleh kosong");
        } else {
            try {
                if (labelGroup.getText().equals("Update Group")) {
                    List<AksesMatrix> list = aksesMatrixDAO.getDataByEquals(AksesMatrix.class, "groups.id", groups.getId());
                    for (AksesMatrix aksesMatrix : list) {
                        aksesMatrixDAO.delete(aksesMatrix);
                    }
                }
                List<AksesMatrix> listAksesMatrixs = new ArrayList<AksesMatrix>();
                for (int x = 0; x < listAksesMatrixView.size(); x++) {
                    AksesMatrix aksesMatrixs = listAksesMatrixView.get(x);
                    if ((Boolean) tableAkses.getValueAt(x, 0)) {
                        aksesMatrixs.setGroups(groups);
                        listAksesMatrixs.add(aksesMatrixs);
                    }
                }
                groupsDAO.saveOrUpdate(groups, listAksesMatrixs);
                GroupUpdateDialog.dispose();
                refresh();
            } catch (Exception ex) {
                Logger.getLogger(KelasIFrame.class.getName()).log(Level.SEVERE, null, ex);
            }
        }
    }
}
